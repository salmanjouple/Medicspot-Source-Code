/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2016, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
 * ---------------------------------------------------------------------------- */
(function(){'use strict';var AdminsHelper=function(){this.filterResults=[]};AdminsHelper.prototype.bindEventHandlers=function(){$('#admins').on('submit','#filter-admins form',function(){var key=$('#filter-admins .key').val();$('#filter-admins .selected').removeClass('selected');this.resetForm();this.filter(key);return!1}.bind(this));$('#admins').on('click','#filter-admins .clear',function(){this.filter('');$('#filter-admins .key').val('');this.resetForm()}.bind(this));$('#admins').on('click','.admin-row',function(e){if($('#filter-admins .filter').prop('disabled')){$('#filter-admins .results').css('color','#AAA');return}
    var adminId=$(e.currentTarget).attr('data-id');var admin={};$.each(this.filterResults,function(index,item){if(item.id===adminId){admin=item;return!1}});this.display(admin);$('#filter-admins .selected').removeClass('selected');$(e.currentTarget).addClass('selected');$('#edit-admin, #delete-admin').prop('disabled',!1)}.bind(this));$('#admins').on('click','#add-admin',function(){this.resetForm();$('#admins .add-edit-delete-group').hide();$('#admins .save-cancel-group').show();$('#admins .record-details').find('input, textarea').prop('readonly',!1);$('#admins .record-details').find('select').prop('disabled',!1);$('#admin-password, #admin-password-confirm').addClass('required');$('#admin-notifications').prop('disabled',!1);$('#filter-admins button').prop('disabled',!0);$('#filter-admins .results').css('color','#AAA')}.bind(this));$('#admins').on('click','#edit-admin',function(){$('#admins .add-edit-delete-group').hide();$('#admins .save-cancel-group').show();$('#admins .record-details').find('input, textarea').prop('readonly',!1);$('#admins .record-details').find('select').prop('disabled',!1);$('#admin-password, #admin-password-confirm').removeClass('required');$('#admin-notifications').prop('disabled',!1);$('#filter-admins .filter').prop('disabled',!0);$('#filter-admins .results').css('color','#AAA')});$('#admins').on('click','#delete-admin',function(){var adminId=$('#admin-id').val();var messageBtns={};messageBtns[EALang['delete']]=function(){this.delete(adminId);$('#message_box').dialog('close')}.bind(this);messageBtns[EALang.cancel]=function(){$('#message_box').dialog('close')};GeneralFunctions.displayMessageBox(EALang.delete_admin,EALang.delete_record_prompt,messageBtns)}.bind(this));$('#admins').on('click','#save-admin',function(){var admin={first_name:$('#admin-first-name').val(),last_name:$('#admin-last-name').val(),email:$('#admin-email').val(),mobile_number:$('#admin-mobile-number').val(),phone_number:$('#admin-phone-number').val(),address:$('#admin-address').val(),city:$('#admin-city').val(),state:$('#admin-state').val(),zip_code:$('#admin-zip-code').val(),notes:$('#admin-notes').val(),settings:{username:$('#admin-username').val(),notifications:$('#admin-notifications').hasClass('active'),calendar_view:$('#admin-calendar-view').val()}};if($('#admin-password').val()!==''){admin.settings.password=$('#admin-password').val()}
    if($('#admin-id').val()!==''){admin.id=$('#admin-id').val()}
    if(!this.validate(admin)){return}
    this.save(admin)}.bind(this));$('#admins').on('click','#cancel-admin',function(){var id=$('#admin-id').val();this.resetForm();if(id!=''){this.select(id,!0)}}.bind(this))};AdminsHelper.prototype.save=function(admin){var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_save_admin';var postData={csrfToken:GlobalVariables.csrfToken,admin:JSON.stringify(admin)};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    Backend.displayNotification(EALang.admin_saved);this.resetForm();$('#filter-admins .key').val('');this.filter('',response.id,!0)}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};AdminsHelper.prototype.delete=function(id){var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_delete_admin';var postData={csrfToken:GlobalVariables.csrfToken,admin_id:id};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    Backend.displayNotification(EALang.admin_deleted);this.resetForm();this.filter($('#filter-admins .key').val())}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};AdminsHelper.prototype.validate=function(admin){$('#admins .required').css('border','');$('#admin-password, #admin-password-confirm').css('border','');try{var missingRequired=!1;$('#admins .required').each(function(){if($(this).val()==''||$(this).val()==undefined){$(this).css('border','2px solid red');missingRequired=!0}});if(missingRequired){throw 'Fields with * are  required.'}
    if($('#admin-password').val()!=$('#admin-password-confirm').val()){$('#admin-password, #admin-password-confirm').css('border','2px solid red');throw EALang.passwords_mismatch}
    if($('#admin-password').val().length<BackendUsers.MIN_PASSWORD_LENGTH&&$('#admin-password').val()!=''){$('#admin-password, #admin-password-confirm').css('border','2px solid red');throw EALang.password_length_notice.replace('$number',BackendUsers.MIN_PASSWORD_LENGTH)}
    if(!GeneralFunctions.validateEmail($('#admin-email').val())){$('#admin-email').css('border','2px solid red');throw EALang.invalid_email}
    if($('#admin-username').attr('already-exists')=='true'){$('#admin-username').css('border','2px solid red');throw EALang.username_already_exists}
    return!0}catch(exc){$('#admins .form-message').text(exc);$('#admins .form-message').show();return!1}};AdminsHelper.prototype.resetForm=function(){$('#admins .add-edit-delete-group').show();$('#admins .save-cancel-group').hide();$('#admins .record-details').find('input, textarea').prop('readonly',!0);$('#admins .record-details').find('select').prop('disabled',!0);$('#admins .form-message').hide();$('#admin-notifications').prop('disabled',!0);$('#admins .required').css('border','');$('#admin-password, #admin-password-confirm').css('border','');$('#admins .record-details').find('input, textarea').val('');$('#admin-notifications').removeClass('active');$('#edit-admin, #delete-admin').prop('disabled',!0);$('#filter-admins .selected').removeClass('selected');$('#filter-admins button').prop('disabled',!1);$('#filter-admins .results').css('color','')};AdminsHelper.prototype.display=function(admin){$('#admin-id').val(admin.id);$('#admin-first-name').val(admin.first_name);$('#admin-last-name').val(admin.last_name);$('#admin-email').val(admin.email);$('#admin-mobile-number').val(admin.mobile_number);$('#admin-phone-number').val(admin.phone_number);$('#admin-address').val(admin.address);$('#admin-city').val(admin.city);$('#admin-state').val(admin.state);$('#admin-zip-code').val(admin.zip_code);$('#admin-notes').val(admin.notes);$('#admin-username').val(admin.settings.username);$('#admin-calendar-view').val(admin.settings.calendar_view);if(admin.settings.notifications==!0){$('#admin-notifications').addClass('active')}else{$('#admin-notifications').removeClass('active')}};AdminsHelper.prototype.filter=function(key,selectId,display){display=display||!1;var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_filter_admins';var postData={csrfToken:GlobalVariables.csrfToken,key:key};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    this.filterResults=response;$('#filter-admins .results').data('jsp').destroy();$('#filter-admins .results').html('');$.each(response,function(index,admin){var html=this.getFilterHtml(admin);$('#filter-admins .results').append(html)}.bind(this));$('#filter-admins .results').jScrollPane({mouseWheelSpeed:70});if(response.length==0){$('#filter-admins .results').html('<em>'+EALang.no_records_found+'</em>')}
    if(selectId!=undefined){this.select(selectId,display)}}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};AdminsHelper.prototype.getFilterHtml=function(admin){var name=admin.first_name+' '+admin.last_name;var info=admin.email;info=(admin.mobile_number!=''&&admin.mobile_number!=null)?info+', '+admin.mobile_number:info;info=(admin.phone_number!=''&&admin.phone_number!=null)?info+', '+admin.phone_number:info;var html='<div class="admin-row entry" data-id="'+admin.id+'">'+'<strong>'+name+'</strong><br>'+info+'<br>'+'</div><hr>';return html};AdminsHelper.prototype.select=function(id,display){display=display||!1;$('#filter-admins .selected').removeClass('selected');$('.admin-row').each(function(){if($(this).attr('data-id')==id){$(this).addClass('selected');return!1}});if(display){$.each(this.filterResults,function(index,admin){if(admin.id==id){this.display(admin);$('#edit-admin, #delete-admin').prop('disabled',!1);return!1}}.bind(this))}};window.AdminsHelper=AdminsHelper})()