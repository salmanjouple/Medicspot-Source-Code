/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2016, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.2.0
 * ---------------------------------------------------------------------------- */

/**
 * Backend Calendar Unavailabilities Modal
 *
 * This module implements the unavailabilities modal functionality.
 *
 * @module BackendCalendarUnavailabilitiesModal
 */
window.BackendCalendarUnavailabilitiesModal=window.BackendCalendarUnavailabilitiesModal||{};(function(exports){'use strict';function _bindEventHandlers(){$('#manage-unavailable #save-unavailable').click(function(){var $dialog=$('#manage-unavailable');var start=$dialog.find('#unavailable-start').datetimepicker('getDate');var end=Date.parse($dialog.find('#unavailable-end').datetimepicker('getDate'));if(start>end){$dialog.find('.modal-message').text(EALang.start_date_before_end_error).addClass('alert-danger').removeClass('hidden');return}
    var unavailable={start_datetime:start.toString('yyyy-MM-dd HH:mm'),end_datetime:end.toString('yyyy-MM-dd HH:mm'),notes:$dialog.find('#unavailable-notes').val(),id_users_provider:$('#unavailable-provider').val()};if($dialog.find('#unavailable-id').val()!==''){unavailable.id=$dialog.find('#unavailable-id').val()}
    var successCallback=function(response){if(response.exceptions){response.exceptions=GeneralFunctions.parseExceptions(response.exceptions);GeneralFunctions.displayMessageBox(GeneralFunctions.EXCEPTIONS_TITLE,GeneralFunctions.EXCEPTIONS_MESSAGE);$('#message_box').append(GeneralFunctions.exceptionsToHtml(response.exceptions));$dialog.find('.modal-message').text(EALang.unexpected_issues_occurred).addClass('alert-danger').removeClass('hidden');return}
        if(response.warnings){response.warnings=GeneralFunctions.parseExceptions(response.warnings);GeneralFunctions.displayMessageBox(GeneralFunctions.WARNINGS_TITLE,GeneralFunctions.WARNINGS_MESSAGE);$('#message_box').append(GeneralFunctions.exceptionsToHtml(response.warnings))}
        $dialog.find('.modal-message').text(EALang.unavailable_saved).addClass('alert-success').removeClass('alert-danger hidden');setTimeout(function(){$dialog.find('.alert').addClass('hidden');$dialog.modal('hide');$('#select-filter-item').trigger('change')},2000)};var errorCallback=function(jqXHR,textStatus,errorThrown){GeneralFunctions.displayMessageBox('Communication Error','Unfortunately '+'the operation could not complete due to server communication errors.');$dialog.find('.modal-message').txt(EALang.service_communication_error);$dialog.find('.modal-message').addClass('alert-danger').removeClass('hidden')};BackendCalendarApi.saveUnavailable(unavailable,successCallback,errorCallback)});$('#manage-unavailable #cancel-unavailable').click(function(){$('#manage-unavailable').modal('hide')});$('#insert-unavailable').click(function(){BackendCalendarUnavailabilitiesModal.resetUnavailableDialog();var $dialog=$('#manage-unavailable');var start=new Date();var currentMin=parseInt(start.toString('mm'));if(currentMin>0&&currentMin<15){start.set({'minute':15})}else if(currentMin>15&&currentMin<30){start.set({'minute':30})}else if(currentMin>30&&currentMin<45){start.set({'minute':45})}else{start.addHours(1).set({'minute':0})}
    if($('.calendar-view').length===0){$dialog.find('#unavailable-provider').val($('#select-filter-item').val()).parents('.form-group').hide()}
    $dialog.find('#unavailable-start').val(GeneralFunctions.formatDate(start,GlobalVariables.dateFormat,!0));$dialog.find('#unavailable-end').val(GeneralFunctions.formatDate(start.addHours(1),GlobalVariables.dateFormat,!0));$dialog.find('.modal-header h3').text(EALang.new_unavailable_title);$dialog.modal('show')})}
    exports.resetUnavailableDialog=function(){var $dialog=$('#manage-unavailable');$dialog.find('#unavailable-id').val('');var start=GeneralFunctions.formatDate(new Date(),GlobalVariables.dateFormat,!0);var end=GeneralFunctions.formatDate(new Date().addHours(1),GlobalVariables.dateFormat,!0);var dateFormat;switch(GlobalVariables.dateFormat){case 'DMY':dateFormat='dd/mm/yy';break;case 'MDY':dateFormat='mm/dd/yy';break;case 'YMD':dateFormat='yy/mm/dd';break}
        $dialog.find('#unavailable-start').datetimepicker({dateFormat:dateFormat,dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,firstDay:1});$dialog.find('#unavailable-start').val(start);$dialog.find('#unavailable-end').datetimepicker({dateFormat:dateFormat,dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,firstDay:1});$dialog.find('#unavailable-end').val(end);$dialog.find('#unavailable-notes').val('')}
    exports.initialize=function(){var $unavailabilityProvider=$('#unavailable-provider');for(var index in GlobalVariables.availableProviders){var provider=GlobalVariables.availableProviders[index];$unavailabilityProvider.append(new Option(provider.first_name+' '+provider.last_name,provider.id))}
        _bindEventHandlers()}})(window.BackendCalendarUnavailabilitiesModal)