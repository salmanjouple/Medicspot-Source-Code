/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2016, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
 * ---------------------------------------------------------------------------- */
window.BackendSettings=window.BackendSettings||{};(function(exports){'use strict';exports.SETTINGS_SYSTEM='SETTINGS_SYSTEM';exports.SETTINGS_USER='SETTINGS_USER';exports.wp={};var settings={};exports.initialize=function(bindEventHandlers){bindEventHandlers=bindEventHandlers||!0;$.each(GlobalVariables.settings.system,function(index,setting){$('input[data-field="'+setting.name+'"]').val(setting.value);$('select[data-field="'+setting.name+'"]').val(setting.value)});var workingPlan={};$.each(GlobalVariables.settings.system,function(index,setting){if(setting.name=='company_working_plan'){workingPlan=$.parseJSON(setting.value)}
    if(setting.name=='customer_notifications'&&setting.value=='1'){$('#customer-notifications').addClass('active')}
    if(setting.name=='require_captcha'&&setting.value=='1'){$('#require-captcha').addClass('active')}});exports.wp=new WorkingPlan();exports.wp.setup(workingPlan);exports.wp.timepickers(!1);$('#book-advance-timeout').spinner({'min':0});$('#user-id').val(GlobalVariables.settings.user.id);$('#first-name').val(GlobalVariables.settings.user.first_name);$('#last-name').val(GlobalVariables.settings.user.last_name);$('#email').val(GlobalVariables.settings.user.email);$('#mobile-number').val(GlobalVariables.settings.user.mobile_number);$('#phone-number').val(GlobalVariables.settings.user.phone_number);$('#address').val(GlobalVariables.settings.user.address);$('#city').val(GlobalVariables.settings.user.city);$('#state').val(GlobalVariables.settings.user.state);$('#zip-code').val(GlobalVariables.settings.user.zip_code);$('#notes').val(GlobalVariables.settings.user.notes);$('#username').val(GlobalVariables.settings.user.settings.username);$('#password, #retype-password').val('');$('#calendar-view').val(GlobalVariables.settings.user.settings.calendar_view);if(GlobalVariables.settings.user.settings.notifications==!0){$('#user-notifications').addClass('active')}else{$('#user-notifications').removeClass('active')}
    settings=new SystemSettings();if(bindEventHandlers){_bindEventHandlers();$('#settings-page .nav li').first().addClass('active');$('#settings-page .nav li').first().find('a').trigger('click')}
    if(GlobalVariables.user.privileges.system_settings.edit==!1){$('#general, #business-logic').find('select, input, textarea').prop('readonly',!0);$('#general, #business-logic').find('button').prop('disabled',!0)}
    if(GlobalVariables.user.privileges.user_settings.edit==!1){$('#user').find('select, input, textarea').prop('readonly',!0);$('#user').find('button').prop('disabled',!0)}
    Backend.placeFooterToBottom()};function _bindEventHandlers(){exports.wp.bindEventHandlers();$('.tab').click(function(){var areNotificationsActive=$('#user-notifications').hasClass('active');$(this).parent().find('.active').removeClass('active');$(this).addClass('active');$('.tab-content').hide();if($(this).hasClass('general-tab')){$('#general').show();settings=new SystemSettings()}else if($(this).hasClass('business-logic-tab')){$('#business-logic').show();settings=new SystemSettings()}else if($(this).hasClass('user-tab')){$('#user').show();settings=new UserSettings();if(areNotificationsActive){$('#user-notifications').addClass('active')}else{$('#user-notifications').removeClass('active')}}else if($(this).hasClass('about-tab')){$('#about').show()}
    Backend.placeFooterToBottom()});$('.save-settings').click(function(){var data=settings.get();settings.save(data)});$('#username').focusout(function(){var $input=$(this);if($input.prop('readonly')==!0||$input.val()==''){return}
    var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_validate_username';var postData={csrfToken:GlobalVariables.csrfToken,username:$input.val(),user_id:$input.parents().eq(2).find('#user-id').val()};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
        if(response==!1){$input.css('border','2px solid red');Backend.displayNotification(EALang.username_already_exists);$input.attr('already-exists','true')}else{$input.css('border','');$input.attr('already-exists','false')}},'json').fail(GeneralFunctions.ajaxFailureHandler)})}})(window.BackendSettings)