/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2016, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
 * ---------------------------------------------------------------------------- */

(function(){'use strict';function CategoriesHelper(){this.filterResults={}};CategoriesHelper.prototype.bindEventHandlers=function(){var instance=this;$('#filter-categories .clear').click(function(){$('#filter-categories .key').val('');instance.filter('');instance.resetForm()});$('#filter-categories form').submit(function(){var key=$('#filter-categories .key').val();$('.selected').removeClass('selected');instance.resetForm();instance.filter(key);return!1});$(document).on('click','.category-row',function(){if($('#filter-categories .filter').prop('disabled')){$('#filter-categories .results').css('color','#AAA');return}
    var categoryId=$(this).attr('data-id');var category={};$.each(instance.filterResults,function(index,item){if(item.id===categoryId){category=item;return!1}});instance.display(category);$('#filter-categories .selected').removeClass('selected');$(this).addClass('selected');$('#edit-category, #delete-category').prop('disabled',!1)});$('#add-category').click(function(){instance.resetForm();$('#categories .add-edit-delete-group').hide();$('#categories .save-cancel-group').show();$('#categories .record-details').find('input, textarea').prop('readonly',!1);$('#filter-categories button').prop('disabled',!0);$('#filter-categories .results').css('color','#AAA')});$('#edit-category').click(function(){$('#categories .add-edit-delete-group').hide();$('#categories .save-cancel-group').show();$('#categories .record-details').find('input, textarea').prop('readonly',!1);$('#filter-categories button').prop('disabled',!0);$('#filter-categories .results').css('color','#AAA')});$('#delete-category').click(function(){var categoryId=$('#category-id').val();var messageBtns={};messageBtns[EALang['delete']]=function(){instance.delete(categoryId);$('#message_box').dialog('close')};messageBtns[EALang.cancel]=function(){$('#message_box').dialog('close')};GeneralFunctions.displayMessageBox(EALang.delete_category,EALang.delete_record_prompt,messageBtns)});$('#save-category').click(function(){var category={name:$('#category-name').val(),description:$('#category-description').val()};if($('#category-id').val()!==''){category.id=$('#category-id').val()}
    if(!instance.validate(category)){return}
    instance.save(category)});$('#cancel-category').click(function(){var id=$('#category-id').val();instance.resetForm();if(id!==''){instance.select(id,!0)}})};CategoriesHelper.prototype.filter=function(key,selectId,display){var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_filter_service_categories';var postData={csrfToken:GlobalVariables.csrfToken,key:key};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    this.filterResults=response;$('#filter-categories .results').data('jsp').destroy();$('#filter-categories .results').html('');$.each(response,function(index,category){var html=this.getFilterHtml(category);$('#filter-categories .results').append(html)}.bind(this));$('#filter-categories .results').jScrollPane({mouseWheelSpeed:70});if(response.length===0){$('#filter-categories .results').html('<em>'+EALang.no_records_found+'</em>')}
    if(selectId!==undefined){this.select(selectId,display)}}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};CategoriesHelper.prototype.save=function(category){var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_save_service_category';var postData={csrfToken:GlobalVariables.csrfToken,category:JSON.stringify(category)};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    Backend.displayNotification(EALang.service_category_saved);this.resetForm();$('#filter-categories .key').val('');this.filter('',response.id,!0);BackendServices.updateAvailableCategories()}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};CategoriesHelper.prototype.delete=function(id){var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_delete_service_category';var postData={csrfToken:GlobalVariables.csrfToken,category_id:id};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    Backend.displayNotification(EALang.service_category_deleted);this.resetForm();this.filter($('#filter-categories .key').val());BackendServices.updateAvailableCategories()}.bind(this),'json').fail(GeneralFunctions.ajaxFailureHandler)};CategoriesHelper.prototype.display=function(category){$('#category-id').val(category.id);$('#category-name').val(category.name);$('#category-description').val(category.description)};CategoriesHelper.prototype.validate=function(category){$('#categories .record-details').find('input, textarea').css('border','');try{var missingRequired=!1;$('#categories .required').each(function(){if($(this).val()===''||$(this).val()===undefined){$(this).css('border','2px solid red');missingRequired=!0}});if(missingRequired){throw EALang.fields_are_required}
    return!0}catch(exc){return!1}};CategoriesHelper.prototype.resetForm=function(){$('#categories .add-edit-delete-group').show();$('#categories .save-cancel-group').hide();$('#categories .record-details').find('input, textarea').val('');$('#categories .record-details').find('input, textarea').prop('readonly',!0);$('#edit-category, #delete-category').prop('disabled',!0);$('#filter-categories .selected').removeClass('selected');$('#filter-categories .results').css('color','');$('#filter-categories button').prop('disabled',!1)};CategoriesHelper.prototype.getFilterHtml=function(category){var html='<div class="category-row entry" data-id="'+category.id+'">'+'<strong>'+category.name+'</strong>'+'</div><hr>';return html};CategoriesHelper.prototype.select=function(id,display){display=display||!1;$('#filter-categories .selected').removeClass('selected');$('#filter-categories .category-row').each(function(){if($(this).attr('data-id')===id){$(this).addClass('selected');return!1}});if(display){$.each(this.filterResults,function(index,category){if(category.id===id){this.display(category);$('#edit-category, #delete-category').prop('disabled',!1);return!1}}.bind(this))}};window.CategoriesHelper=CategoriesHelper})()