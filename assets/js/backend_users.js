/* ----------------------------------------------------------------------------
 * Easy!Appointments - Open Source Web Scheduler
 *
 * @package     EasyAppointments
 * @author      A.Tselegidis <alextselegidis@gmail.com>
 * @copyright   Copyright (c) 2013 - 2016, Alex Tselegidis
 * @license     http://opensource.org/licenses/GPL-3.0 - GPLv3
 * @link        http://easyappointments.org
 * @since       v1.0.0
 * ---------------------------------------------------------------------------- */
window.BackendUsers=window.BackendUsers||{};(function(exports){'use strict';exports.MIN_PASSWORD_LENGTH=7;var helper={};exports.wp={};exports.initialize=function(defaultEventHandlers){defaultEventHandlers=defaultEventHandlers||!0;$('#filter-admins .results').jScrollPane();$('#filter-providers .results').jScrollPane();$('#filter-secretaries .results').jScrollPane();helper=new AdminsHelper();helper.resetForm();helper.filter('');helper.bindEventHandlers();exports.wp=new WorkingPlan();exports.wp.bindEventHandlers();var html='<div class="col-md-12">';$.each(GlobalVariables.services,function(index,service){html+='<div class="checkbox">'+'<label class="checkbox">'+'<input type="checkbox" data-id="'+service.id+'" />'+service.name+'</label>'+'</div>'});html+='</div>';$('#provider-services').html(html);$('#provider-services').jScrollPane({mouseWheelSpeed:70});html='<div class="col-md-12">';$.each(GlobalVariables.providers,function(index,provider){html+='<div class="checkbox">'+'<label class="checkbox">'+'<input type="checkbox" data-id="'+provider.id+'" />'+provider.first_name+' '+provider.last_name+'</label>'+'</div>'});html+='</div>';$('#secretary-providers').html(html);$('#secretary-providers').jScrollPane({mouseWheelSpeed:70});$('#reset-working-plan').qtip({position:{my:'top center',at:'bottom center'},style:{classes:'qtip-green qtip-shadow custom-qtip'}});if(defaultEventHandlers){_bindEventHandlers()}};function _bindEventHandlers(){$('.tab').click(function(){$(this).parent().find('.active').removeClass('active');$(this).addClass('active');$('.tab-content').hide();$('#admins, #providers, #secretaries').off();if($(this).hasClass('admins-tab')){$('#admins').show();helper=new AdminsHelper()}else if($(this).hasClass('providers-tab')){$('#providers').show();$('#provider-services').data('jsp').destroy();$('#provider-services').jScrollPane({mouseWheelSpeed:70});helper=new ProvidersHelper()}else if($(this).hasClass('secretaries-tab')){$('#secretaries').show();helper=new SecretariesHelper();var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_filter_providers';var postData={csrfToken:GlobalVariables.csrfToken,key:''};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
    GlobalVariables.providers=response;$('#secretary-providers').data('jsp').destroy();var html='<div class="col-md-12">';$.each(GlobalVariables.providers,function(index,provider){html+='<div class="checkbox">'+'<label class="checkbox">'+'<input type="checkbox" data-id="'+provider.id+'" />'+provider.first_name+' '+provider.last_name+'</label>'+'</div>'});html+='</div>';$('#secretary-providers').html(html);$('#secretary-providers input[type="checkbox"]').prop('disabled',!0);$('#secretary-providers').jScrollPane({mouseWheelSpeed:70})},'json').fail(GeneralFunctions.ajaxFailureHandler)}
    helper.resetForm();helper.filter('');helper.bindEventHandlers();$('.filter-key').val('')});$('#admin-username, #provider-username, #secretary-username').focusout(function(){var $input=$(this);if($input.prop('readonly')==!0||$input.val()==''){return}
    var userId=$input.parents().eq(2).find('.record-id').val();if(userId==undefined){return}
    var postUrl=GlobalVariables.baseUrl+'//backend_api/ajax_validate_username';var postData={csrfToken:GlobalVariables.csrfToken,username:$input.val(),user_id:userId};$.post(postUrl,postData,function(response){if(!GeneralFunctions.handleAjaxExceptions(response)){return}
        if(response==!1){$input.css('border','2px solid red');$input.attr('already-exists','true');$input.parents().eq(3).find('.form-message').text(EALang.username_already_exists);$input.parents().eq(3).find('.form-message').show()}else{$input.css('border','');$input.attr('already-exists','false');if($input.parents().eq(3).find('.form-message').text()==EALang.username_already_exists){$input.parents().eq(3).find('.form-message').hide()}}},'json').fail(GeneralFunctions.ajaxFailureHandler)})}})(window.BackendUsers)